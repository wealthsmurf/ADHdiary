<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOOK LOG - ADHDIARY</title>
    <style>
        :root {
            --bg-color: #F2F2F2;
            --card-bg: #FFFFFF;
            --text-main: #444444;
            --text-sub: #BBBBBB;
            --border-color: #EEEEEE;
            --book-green: #4CAF50;
        }

        body.dark-mode {
            --bg-color: #121212;
            --card-bg: #1E1E1E;
            --text-main: #FFFFFF;
            --text-sub: #888888;
            --border-color: #333333;
        }

        body { 
            margin: 0; padding: 0; font-family: 'Apple SD Gothic Neo', sans-serif;
            background-color: var(--bg-color); color: var(--text-main);
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        .header {
            width: 100%; max-width: 400px; padding: 40px 20px 20px;
            display: flex; justify-content: space-between; align-items: center; box-sizing: border-box;
        }

        .back-btn { font-size: 24px; cursor: pointer; color: var(--book-green); text-decoration: none; }
        .title { font-size: 20px; font-weight: 900; }

        .form-card {
            background: var(--card-bg); width: 90%; max-width: 380px;
            border-radius: 30px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            box-sizing: border-box; margin-bottom: 30px;
        }

        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 11px; color: var(--text-sub); margin-bottom: 6px; font-weight: bold; }
        
        input[type="text"], input[type="date"], textarea {
            width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border-color);
            background: var(--bg-color); color: var(--text-main); font-size: 14px;
            box-sizing: border-box; outline: none; transition: 0.3s;
        }

        textarea { height: 80px; resize: none; }
        input:focus, textarea:focus { border-color: var(--book-green); }

        .file-wrapper {
            width: 100%; height: 100px; border: 2px dashed var(--border-color);
            border-radius: 15px; display: flex; align-items: center; justify-content: center; 
            cursor: pointer; overflow: hidden; position: relative; background: var(--bg-color);
        }
        #preview { width: 100%; height: 100%; object-fit: cover; display: none; }

        .submit-btn {
            width: 100%; height: 50px; background: var(--book-green);
            color: white; border: none; border-radius: 12px;
            font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px;
        }
        /* Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Ïãú Ïä§ÌÉÄÏùº */
        .submit-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .record-list { width: 90%; max-width: 380px; padding-bottom: 50px; }
        .record-card {
            background: var(--card-bg); padding: 15px; border-radius: 20px;
            margin-bottom: 12px; cursor: pointer; display: flex; align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.02); transition: transform 0.2s;
        }
        .record-card:active { transform: scale(0.98); }

        .thumb-area { width: 45px; height: 60px; border-radius: 6px; margin-right: 15px; overflow: hidden; flex-shrink: 0; }
        .thumb-area img { width: 100%; height: 100%; object-fit: cover; }
        .thumb-placeholder { width: 100%; height: 100%; background: var(--bg-color); display: flex; align-items: center; justify-content: center; font-size: 18px; }

        .record-info b { font-size: 15px; color: var(--text-main); display: block; }
        .record-info p { font-size: 11px; color: var(--text-sub); margin-top: 3px; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: none;
            justify-content: center; align-items: center; z-index: 5000;
            backdrop-filter: blur(8px);
        }
        .modal-content {
            background: var(--card-bg); width: 85%; max-width: 350px;
            border-radius: 30px; padding: 25px; display: flex; flex-direction: column;
            max-height: 75vh; box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }
        .modal-header { flex-shrink: 0; margin-bottom: 15px; border-bottom: 2px solid var(--border-color); padding-bottom: 15px; }
        .modal-title { font-size: 20px; font-weight: 900; color: var(--book-green); }
        .modal-date { font-size: 12px; color: var(--text-sub); margin-top: 5px; }
        
        .modal-body { 
            font-size: 15px; line-height: 1.7; color: var(--text-main);
            flex: 1; overflow-y: auto; padding-right: 5px; white-space: pre-wrap;
        }
        .modal-body img { width: 60%; display: block; margin: 0 auto 15px auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .modal-body::-webkit-scrollbar { width: 4px; }
        .modal-body::-webkit-scrollbar-thumb { background: var(--book-green); border-radius: 10px; }

        .modal-footer { flex-shrink: 0; display: flex; gap: 10px; margin-top: 20px; }
        .btn-close { flex: 1; padding: 15px; border-radius: 15px; border: none; background: var(--border-color); color: var(--text-main); font-weight: bold; cursor: pointer; }
        .btn-del { flex: 0.5; background: #ff8a80; color: white; border: none; padding: 15px; border-radius: 15px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <a href="/" class="back-btn">„Äà</a>
        <div class="title">üìñ ÎèÖÏÑú Í∏∞Î°ù</div>
        <div style="width:24px;"></div>
    </div>

    <div class="form-card">
        <form id="recordForm" action="/save_book" method="post" enctype="multipart/form-data">
            <div class="input-group">
                <label>BOOK TITLE</label>
                <input type="text" name="title" placeholder="Ï±Ö Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
            </div>
            <div class="input-group">
                <label>DATE</label>
                <input type="date" name="date" id="currentDate" required>
            </div>
            <div class="input-group">
                <label>BOOK COVER (PHOTO)</label>
                <div class="file-wrapper" onclick="document.getElementById('image').click()">
                    <img id="preview" src="#">
                    <div id="file-msg" style="text-align: center; color: var(--text-sub); font-size: 12px;">
                        üì∏ ÌëúÏßÄ Ï∂îÍ∞Ä
                    </div>
                    <input type="file" id="image" name="image" accept="image/*" style="display:none;" onchange="previewImage(this)">
                </div>
            </div>
            <div class="input-group">
                <label>MEMO / REVIEW</label>
                <textarea name="memo" placeholder="Ïù∏ÏÉÅ ÍπäÏóàÎçò Íµ¨Ï†àÏù¥ÎÇò Í∞êÏÉÅÏùÑ Ï†ÅÏñ¥Ï£ºÏÑ∏Ïöî." required></textarea>
            </div>
            <button type="submit" id="submitBtn" class="submit-btn">Í∏∞Î°ùÌïòÍ∏∞</button>
        </form>
    </div>

    <div class="record-list">
        <h3 style="font-size: 11px; color: var(--text-sub); letter-spacing: 1px; margin-bottom: 15px;">MY READING LOGS</h3>
        {% for record in my_records %}
        <div class="record-card" 
             onclick="openModal(this)"
             data-title="{{ record.title }}"
             data-date="{{ record.date }}"
             data-id="{{ record.id }}"
             data-memo="{{ record.memo }}"
             data-image="{{ record.image_url if record.image_url else '' }}">
            
            <div class="thumb-area">
                {% if record.image_url %}
                <img src="{{ record.image_url }}">
                {% else %}
                <div class="thumb-placeholder">üìñ</div>
                {% endif %}
            </div>
            <div class="record-info">
                <b>{{ record.title }}</b>
                <p>{{ record.date }}</p>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="modal-overlay" id="detailModal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title" id="mTitle">Ï†úÎ™©</div>
                <div class="modal-date" id="mDate">ÎÇ†Ïßú</div>
            </div>
            <div class="modal-body">
                <div id="mImageContainer"></div>
                <div id="mMemo">ÎÇ¥Ïö©</div>
            </div>
            <div class="modal-footer">
                <button class="btn-close" onclick="closeModal()">Îã´Í∏∞</button>
                <form id="deleteForm" method="post" style="flex: 0.5;">
                    <button type="submit" class="btn-del" onclick="return confirm('Ïù¥ Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌï†ÍπåÏöî?')">ÏÇ≠Ï†ú</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Ìèº Ï†úÏ∂ú Ïãú Î≤ÑÌäº ÏÉÅÌÉú Î≥ÄÍ≤Ω
        document.getElementById('recordForm').onsubmit = function() {
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerText = "Ï†ÄÏû• Ï§ë...";
        };

        function openModal(element) {
            const title = element.getAttribute('data-title');
            const date = element.getAttribute('data-date');
            const id = element.getAttribute('data-id');
            const memo = element.getAttribute('data-memo');
            const imageUrl = element.getAttribute('data-image');

            document.getElementById('mTitle').innerText = title;
            document.getElementById('mDate').innerText = date;
            document.getElementById('mMemo').innerText = memo;
            
            const imgContainer = document.getElementById('mImageContainer');
            imgContainer.innerHTML = ''; 
            if (imageUrl && imageUrl !== '') {
                const img = document.createElement('img');
                img.src = imageUrl;
                imgContainer.appendChild(img);
            }

            document.getElementById('deleteForm').action = `/delete_book/${id}`;
            document.getElementById('detailModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function previewImage(input) {
            const preview = document.getElementById('preview');
            const msg = document.getElementById('file-msg');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    msg.style.display = 'none';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        document.getElementById('currentDate').value = new Date().toISOString().substring(0, 10);
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
    </script>
</body>
</html>
